{{#querylink:ContactManager:{{#if: {{#urlget:pageid}} | messages | headers }}|&larr; go back
|folder={{#urldecode:{{#urlget:folder}}}}
|shortpath={{#urldecode:{{#urlget:shortpath}}}}
|mailbox={{#urldecode:{{#urlget:mailbox}}}}
|path={{#urldecode:{{#urlget:path}}}}
}}

{{#if: {{#urlget:pageid}} | 
  {{#visualdataprint: {{#urlget:pageid}}
    |schema=ContactManager/Incoming mail
    |?date   
    |?headers/fromaddress
    |?subject
    |?replyTo=
    |?textPlain=
    |?textHtml=
    |?visibleText=
    |?headersRaw=
    |format=template
    |template=ContactManager/Email
  }} 
|
  {{#if: {{#visualdataquery: [[id::{{#urlget:uid}}]] [[mailboxFolder:: {{#urlget:shortpath}} ]] 
    |schema=ContactManager/Incoming mail 
    |format=pageid 
  }} |
    {{#visualdataprint: {{#visualdataquery: [[id::{{#urlget:uid}}]] [[mailboxFolder:: {{#urlget:shortpath}} ]] 
      |schema=ContactManager/Incoming mail 
      |format=pageid 
    }} 
      |schema=ContactManager/Incoming mail
      |?date   
      |?headers/fromaddress
      |?subject
      |?replyTo=
      |?textPlain=
      |?textHtml=
      |?visibleText=
      |?headersRaw=
      |format=template
      |template=ContactManager/Email
    }} 
  | 
    {{#VisualDataButton: Get message
      |callback = ContactManager.initJob
      |icon=reload 
      |schema = ContactManager/Retrieve messages
      |preload-data=ContactManager:Mailboxes/{{#urlget:mailbox}}/Jobs/GetMessages
      |preload-data?job=retrieve-message
      |preload-data?uid={{#urlget:uid}}
      |preload-data?folder={{#urlget:shortpath}}
      |preload-data?folder_name={{#urlget:folder}} 
    }}
  }}
}}

